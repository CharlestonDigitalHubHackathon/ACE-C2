<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="theme-color" content="#000000" />
    <!--
      manifest.json provides metadata used when your web app is installed on a
      user's mobile device or desktop. See https://developers.google.com/web/fundamentals/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.

      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>Power Router MK_I</title>
    <style>

      /* api key AIzaSyC6g6QtvZvZrslrtFKXNcvIoHV9qVXJNac */
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }

      .green {
        color: green;
      }
      .gray {
        color: gray;
      }

      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="map"></div>
    <div id="root"></div>
    <!--
      This HTML file is a template.
      If you open it directly in the browser, you will see an empty page.

      You can add webfonts, meta tags, or analytics to this file.
      The build step will place the bundled scripts into the <body> tag.

      To begin the development, run `npm start` or `yarn start`.
      To create a production bundle, use `npm run build` or `yarn build`.
    -->

    <script>


      function initMap() {
        var windows = [];
        var npos = [];
        var testData =
          {
"global_power_plant_database": [
{
		"country" : "USA",
		"country_long" : "United States of America",
		"name" : "Anderson Ranch",
		"gppd_idnr" : "USA0006395",
		"capacity_mw" : 40.0,
		"latitude" : 43.3571,
		"longitude" : -115.4515,
		"fuel1" : "Hydro",
		"fuel2" : "",
		"fuel3" : "",
		"fuel4" : "",
		"commissioning_year" : 1951,
		"owner" : "U S Bureau of Reclamation",
		"source" : "U.S. Energy Information Administration",
		"url" : "http:\/\/www.eia.gov\/electricity\/data\/browser\/",
		"geolocation_source" : "U.S. Energy Information Administration",
		"year_of_capacity_data" : 2016,
		"generation_gwh_2013" : null,
		"generation_gwh_2014" : null,
		"generation_gwh_2015" : null,
		"generation_gwh_2016" : 145.394,
		"estimated_generation_gwh" : 111.51560524092878
	},
	{
		"country" : "USA",
		"country_long" : "United States of America",
		"name" : "Anderson Regional Landfill",
		"gppd_idnr" : "USA0056121",
		"capacity_mw" : 3.2,
		"latitude" : 34.5739,
		"longitude" : -82.4621,
		"fuel1" : "Waste",
		"fuel2" : "",
		"fuel3" : "",
		"fuel4" : "",
		"commissioning_year" : 2008,
		"owner" : "South Carolina Public Service Authority",
		"source" : "U.S. Energy Information Administration",
		"url" : "http:\/\/www.eia.gov\/electricity\/data\/browser\/",
		"geolocation_source" : "U.S. Energy Information Administration",
		"year_of_capacity_data" : 2016,
		"generation_gwh_2013" : null,
		"generation_gwh_2014" : null,
		"generation_gwh_2015" : null,
		"generation_gwh_2016" : 9.44,
		"estimated_generation_gwh" : 3.9963458099049136
	},
	{
		"country" : "USA",
		"country_long" : "United States of America",
		"name" : "Anderson Wind I",
		"gppd_idnr" : "USA0058939",
		"capacity_mw" : 5.0,
		"latitude" : 33.0294,
		"longitude" : -103.8558,
		"fuel1" : "Wind",
		"fuel2" : "",
		"fuel3" : "",
		"fuel4" : "",
		"commissioning_year" : 2015,
		"owner" : "BayWa r.e Wind LLC",
		"source" : "U.S. Energy Information Administration",
		"url" : "http:\/\/www.eia.gov\/electricity\/data\/browser\/",
		"geolocation_source" : "U.S. Energy Information Administration",
		"year_of_capacity_data" : 2016,
		"generation_gwh_2013" : null,
		"generation_gwh_2014" : null,
		"generation_gwh_2015" : null,
		"generation_gwh_2016" : 17.782,
		"estimated_generation_gwh" : 11.274164792666516
	},
	{
		"country" : "USA",
		"country_long" : "United States of America",
		"name" : "Anderson Wind II",
		"gppd_idnr" : "USA0058940",
		"capacity_mw" : 10.0,
		"latitude" : 33.0139,
		"longitude" : -103.865,
		"fuel1" : "Wind",
		"fuel2" : "",
		"fuel3" : "",
		"fuel4" : "",
		"commissioning_year" : 2015,
		"owner" : "BayWa r.e Wind LLC",
		"source" : "U.S. Energy Information Administration",
		"url" : "http:\/\/www.eia.gov\/electricity\/data\/browser\/",
		"geolocation_source" : "U.S. Energy Information Administration",
		"year_of_capacity_data" : 2016,
		"generation_gwh_2013" : null,
		"generation_gwh_2014" : null,
		"generation_gwh_2015" : null,
		"generation_gwh_2016" : 40.666000000000004,
		"estimated_generation_gwh" : 22.548329585333033
	},
	{
		"country" : "USA",
		"country_long" : "United States of America",
		"name" : "Andrew Solar",
		"gppd_idnr" : "USA0059497",
		"capacity_mw" : 5.0,
		"latitude" : 35.1608,
		"longitude" : -77.1099,
		"fuel1" : "Solar",
		"fuel2" : "",
		"fuel3" : "",
		"fuel4" : "",
		"commissioning_year" : 2016,
		"owner" : "Cypress Creek Renewables",
		"source" : "U.S. Energy Information Administration",
		"url" : "http:\/\/www.eia.gov\/electricity\/data\/browser\/",
		"geolocation_source" : "U.S. Energy Information Administration",
		"year_of_capacity_data" : 2016,
		"generation_gwh_2013" : null,
		"generation_gwh_2014" : null,
		"generation_gwh_2015" : null,
		"generation_gwh_2016" : 9.942,
		"estimated_generation_gwh" : 5.7611116184642155
	}
]};
        var chicago = new google.maps.LatLng(41.850, -87.650);
        let info = null;
        var map = new google.maps.Map(document.getElementById('map'), {
          center: chicago,
          zoom: 3
        });
        //infoWindow = new google.maps.InfoWindow;

       // Try HTML5 geolocation.
       if(navigator.geolocation) {
         navigator.geolocation.getCurrentPosition(function(position) {
           var pos = {
             lat: position.coords.latitude,
             lng: position.coords.longitude
           };
           var newcenter = new google.maps.LatLng(pos.lat, pos.lng);
           map.setCenter(newcenter);
           console.log(pos.lat);
           console.log(pos.lng);
           const URL = 'http://jsonplaceholder.typicode.com/posts';
           const params = {
             name: "Said" ,
             id:21
           }
           //var jsonData = JSON.parse(testData);
           for (var i = 0; i < testData.global_power_plant_database.length; i++) {
             var counter = testData.global_power_plant_database[i];
             console.log(counter.name);
             windows[i] = new google.maps.InfoWindow();
             npos[i] = new google.maps.LatLng(counter.latitude, counter.longitude);
             windows[i].setContent(createInfoWindowContent(npos[i], map.getZoom(), counter));
             windows[i].setPosition(npos[i]);
             windows[i].open(map);
           }
           var coordInfoWindow;
           axios.get(URL, params)
           .then(data=> {
           //   let info = data;
           //   //let test;
           //   console.log(createInfoWindowContent(chicago, map.getZoom(), info));
           // var coordInfoWindow = new google.maps.InfoWindow({maxWidth:100});
           // //var npos = new google.maps.LatLng(pos.lat, pos.lng);
           // coordInfoWindow.setContent(createInfoWindowContent(npos[0], map.getZoom(), info));
           // coordInfoWindow.setPosition(chicago);
           // coordInfoWindow.open(map);
           // console.log(data);
           console.log("finished");
         })

           .catch(err=>console.log(err))
          // infoWindow.setPosition(pos);
           //infoWindow.setContent('Location found.');
           //infoWindow.open(map);
          // map.setCenter(pos);
         }, function() {
           console.log("hello");
         });
       } else {
         console.log("no location");
       }



        map.addListener('zoom_changed', function() {
          for (var i = 0; i < testData.global_power_plant_database.length; i++) {
            var counter = testData.global_power_plant_database[i];
            console.log(counter.name);
            windows[i] = new google.maps.InfoWindow();
            npos[i] = new google.maps.LatLng(counter.latitude, counter.longitude);
            windows[i].setContent(createInfoWindowContent(npos[i], map.getZoom(), counter));
            windows[i].setPosition(npos[i]);
            windows[i].open(map);
          }
        });
      }

      var TILE_SIZE = 256;


      function createInfoWindowContent(latLng, zoom, data) {
        var scale = 3 << zoom;

        var worldCoordinate = project(latLng);

        var pixelCoordinate = new google.maps.Point(
            Math.floor(worldCoordinate.x * scale),
            Math.floor(worldCoordinate.y * scale));

        var tileCoordinate = new google.maps.Point(
            Math.floor(worldCoordinate.x * scale / TILE_SIZE),
            Math.floor(worldCoordinate.y * scale / TILE_SIZE));

        var result =  [
          'Country: ' + data.country_long,
          'Name: ' + data.name,
          'GPS: ' + data.latitude + ', ' + data.longitude,
          'estimated generation (gigawatt hours): ' + Math.round(data.estimated_generation_gwh * 10) / 10,
        ]
        if(data.estimated_generation_gwh == ""){
          result.push('<span class ="gray">' + "â–„" + '</span>' + '\n')
        } else if(data.estimated_generation_gwh == 0){
          result.push("â–„" + '\n')
        } else if(data.estimated_generation_gwh > 0){
          result.push('<span class ="green">' + "â–„" + '</span>' + "\n")
        };
        result.push(" ");
        result.push('fuel 1: ' + data.fuel1);
        if(data.fuel2 != ""){
          result.push('fuel 2: ' + data.fuel2)
        };
        if(data.fuel3 != ""){
          result.push('fuel 3: ' + data.fuel3)
        };
        if(data.fuel4 != ""){
          result.push('fuel 4: ' + data.fuel4)
        };
        return result.join('<br>');
      }

      // The mapping between latitude, longitude and pixels is defined by the web
      // mercator projection.
      function project(latLng) {
        var siny = Math.sin(latLng.lat() * Math.PI / 180);

        // Truncating to 0.9999 effectively limits latitude to 89.189. This is
        // about a third of a tile past the edge of the world tile.
        siny = Math.min(Math.max(siny, -0.9999), 0.9999);

        return new google.maps.Point(
            TILE_SIZE * (0.5 + latLng.lng() / 360),
            TILE_SIZE * (0.5 - Math.log((1 + siny) / (1 - siny)) / (4 * Math.PI)));
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6g6QtvZvZrslrtFKXNcvIoHV9qVXJNac&callback=initMap">
    </script>
      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </body>
</html>
